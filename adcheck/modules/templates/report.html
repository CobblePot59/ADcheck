<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ADcheck Report - {{ domain }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;600&display=swap" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background-color: white;
      color: #222;
      display: flex;
      flex-direction: column;
    }

    header {
      background: linear-gradient(90deg, #1e2a38, #2f3e4d);
      color: white;
      padding: 1.5em 2em;
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: 1.8em;
    }

    header p {
      margin: 0.5em 0 0;
      font-size: 0.95em;
      color: #ccc;
    }

    .container {
      padding: 2em;
      max-width: 1200px;
      margin: auto;
      flex: 1;
      width: 100%;
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5em;
    }

    .card {
      border-radius: 12px;
      padding: 1.5em;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.2s;
      background-color: white;
    }

    .card:hover {
      transform: scale(1.02);
    }

    .card h3 {
      margin-top: 0;
      font-size: 1.2em;
    }

    .score {
      font-size: 2em;
      font-weight: bold;
    }

    .score.red { color: #c93131; }
    .score.orange { color: #f4a261; }
    .score.yellow { color: #e9c46a; }
    .score.green { color: #2a9d8f; }

    .hidden {
      display: none;
    }

    .detail-view {
      padding: 2em;
    }

    .detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .back-btn {
      padding: 0.5em 1em;
      background-color: #1e2a38;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .check-list {
      margin-top: 2em;
    }

    .check-text {
      margin-bottom: 0.8em;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .green-text { color: #26b260; }
    .red-text { color: #c93131; }
    .black-text { color: #1e2a38; }

    summary {
      cursor: pointer;
      font-weight: 600;
      margin-top: 2em;
    }

    footer {
      background: #1e2a38;
      color: #ccc;
      text-align: center;
      padding: 1.2em;
      font-size: 0.85em;
    }

    footer a {
      color: #4fd1c5;
      text-decoration: none;
    }

    footer strong {
      color: #4fd1c5;
    }

    @media (max-width: 768px) {
      .detail-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1em;
      }
    }
  </style>
</head>
<body>

<header>
  <h1>ADcheck Report – {{ domain }}</h1>
  <p>Date : {{ date }}</p>
</header>

<div class="container">

  <div id="summary-view">
    <h2 style="text-align:center; margin-bottom: 1.5em;">Global Score :
      <span class="score {{ 'green' if scores.total >= 75 else 'yellow' if scores.total >= 50 else 'orange' if scores.total >= 25 else 'red' }}">
        {{ scores.total }}%
      </span>
    </h2>

    <div class="cards">
      <div class="card" onclick="showDetail('privs')">
        <h3>Privilege and Trust Management</h3>
        <div class="score {{ 'green' if scores.privs >= 75 else 'yellow' if scores.privs >= 50 else 'orange' if scores.privs >= 25 else 'red' }}">{{ scores.privs }}%</div>
      </div>
      <div class="card" onclick="showDetail('user')">
        <h3>User Account Management</h3>
        <div class="score {{ 'green' if scores.user >= 75 else 'yellow' if scores.user >= 50 else 'orange' if scores.user >= 25 else 'red' }}">{{ scores.user }}%</div>
      </div>
      <div class="card" onclick="showDetail('domain')">
        <h3>Computer and Domain Management</h3>
        <div class="score {{ 'green' if scores.domain >= 75 else 'yellow' if scores.domain >= 50 else 'orange' if scores.domain >= 25 else 'red' }}">{{ scores.domain }}%</div>
      </div>
      <div class="card" onclick="showDetail('policy')">
        <h3>Audit and Policy Management</h3>
        <div class="score {{ 'green' if scores.policy >= 75 else 'yellow' if scores.policy >= 50 else 'orange' if scores.policy >= 25 else 'red' }}">{{ scores.policy }}%</div>
      </div>
    </div>
  </div>

  <div id="detail-view" class="hidden">
    <div class="detail-header">
      <h2 id="detail-title"></h2>
      <button class="back-btn" onclick="goBack()">← Retour</button>
    </div>

    <details open>
      <summary>❌ Ko</summary>
      <div id="red-list" class="check-list"></div>
    </details>

    <details>
      <summary>✅ Ok</summary>
      <div id="green-list" class="check-list"></div>
    </details>

    <details>
      <summary>ℹ️ Info</summary>
      <div id="black-list" class="check-list"></div>
    </details>
  </div>
</div>

<footer>
  Report generated by <strong>CobblePot59</strong> — <a href="https://github.com/CobblePot59/ADcheck" target="_blank">GitHub ADcheck</a>
</footer>

<script>
  const data = {
    "privs": {{ privs_list|tojson }},
    "user": {{ user_list|tojson }},
    "domain": {{ domain_list|tojson }},
    "policy": {{ policy_list|tojson }}
  };

  function showDetail(type) {
    const mapping = {
      "privs": "Privilege and Trust Management",
      "user": "User Account Management",
      "domain": "Computer and Domain Management",
      "policy": "Audit and Policy Management",
    };

    document.getElementById("summary-view").classList.add("hidden");
    document.getElementById("detail-view").classList.remove("hidden");
    document.getElementById("detail-title").innerText = mapping[type];

    const sectionData = data[type] || [];

    const redList = document.getElementById("red-list");
    const greenList = document.getElementById("green-list");
    const blackList = document.getElementById("black-list");

    redList.innerHTML = '';
    greenList.innerHTML = '';
    blackList.innerHTML = '';

    sectionData.forEach(item => {
      let div = document.createElement("div");
      let content = item.message;

      if (content.includes("{") && content.includes("}")) {
        try {
          const jsonStart = content.indexOf('{');
          const json = JSON.stringify(JSON.parse(content.slice(jsonStart)), null, 2);
          content = content.slice(0, jsonStart) + '<pre>' + json + '</pre>';
        } catch (e) {}
      }

      div.classList.add("check-text");

      if (item.color === "green") {
        div.classList.add("green-text");
        div.innerHTML = `✅ ${content}`;
        greenList.appendChild(div);
      } else if (item.color === "black") {
        div.classList.add("black-text");
        div.innerHTML = `ℹ️ ${content}`;
        blackList.appendChild(div);
      } else {
        div.classList.add("red-text");
        div.innerHTML = `❌ ${content}`;
        redList.appendChild(div);
      }
    });
  }

  function goBack() {
    document.getElementById("detail-view").classList.add("hidden");
    document.getElementById("summary-view").classList.remove("hidden");
  }
</script>

</body>
</html>
